<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/>

        <script src="../../resources/sap-ui-core.js"
                id="sap-ui-bootstrap"
                data-sap-ui-libs="sap.m, sap.ui.layout, sap.ui.table"
                data-sap-ui-theme="sap_bluecrystal">
        </script>

        <script>        
        
            sap.ui.getCore().attachInit(function(){
                
                // 绑定json数据到core对象
                var oModel = new sap.ui.model.json.JSONModel();
                oModel.loadData("models/supplier_products.json");
                sap.ui.getCore().setModel(oModel);
                
                // sap.ui.table.Table对象，显示供应商
                var oColumns = [
                    new sap.ui.table.Column({
                        label: new sap.m.Label({text: "ID"}),
                        visible: false,
                        template: new sap.m.Text({text: "{id}"})
                    }),
                    new sap.ui.table.Column({
                        label: new sap.m.Label({text: "供应商名称"}),
                        visible: true,
                        template: new sap.m.Text({text: "{supplier_name}"})
                    }),
                    new sap.ui.table.Column({
                        label: new sap.m.Label({text: "联系人"}),
                        visible: true,
                        template: new sap.m.Text({text: "{contact}"})
                    })
                ];
                
                var oSupplierTable = new sap.ui.table.Table({
                    width: "100%",
                    title: "供应商",
                    visibleRowCount: 3,
                    selectionMode: sap.ui.table.SelectionMode.Single,
                    editable: false,
                    columns: oColumns
                }); 
                
                oSupplierTable.bindRows("/suppliers");              
                oSupplierTable.placeAt("master");
                
                // 定义sap.ui.table.Table对象，显示供应商的产品
                var oColumnsDetail = [
                    new sap.ui.table.Column({
                        label: new sap.m.Label({text: "产品ID"}),
                        visible: true,
                        template: new sap.m.Text({text: "{product_id}"})
                    }),
                    new sap.ui.table.Column({
                        label: new sap.m.Label({text: "产品名称"}),
                        visible: true,
                        template: new sap.m.Text({text: "{product_name}"})
                    })                  
                ];
                
                var oProductTable = new sap.ui.table.Table({
                    width: "100%",
                    title: "产品",
                    visibleRowCount: 3,
                    selectionMode: sap.ui.table.SelectionMode.Single,
                    editable: false,
                    columns: oColumnsDetail
                }); 
                
                oProductTable.bindRows("/products");
                oProductTable.placeAt("detail");
                
                // 定义rowselectionchange事件的处理函数
                oSupplierTable.attachRowSelectionChange(function(oEvent){
                    // 获取row index
                    var oRowContext = oEvent.getParameter("rowContext");
                    
                    // 根据row index获取model数据中的id
                    var sSelectedId = oModel.getProperty("id", oRowContext);                    
                    
                    // 对products中的数据进行过滤
                    var oBinding = oProductTable.getBinding();
                    
                    // 过滤条件：supplier_id = id
                    var oFilter = new sap.ui.model.Filter(
                            "supplier_id",
                            sap.ui.model.FilterOperator.EQ,
                            sSelectedId);
                    
                    // 执行过滤
                    oBinding.filter(oFilter);
                });
                
            }); // end of attachInit()          
            
        </script>

    </head>
    <body class="sapUiBody sapUiResponsiveMargin" role="application">
        <div id="master"></div>
        <div id="detail"></div>
    </body>
</html>