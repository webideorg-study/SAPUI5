!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FakeRest=e():t.FakeRest=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=n(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),i=r(o),u=n(64),a=r(u),s=n(67),c=r(s);e["default"]={Server:i["default"],Collection:a["default"],Single:c["default"]},t.exports=e["default"]},function(t,e){"use strict";e["default"]=function(t){return t&&t.__esModule?t:{"default":t}},e.__esModule=!0},function(t,e,n){"use strict";function r(t){if(!t)return{};var e={},n=t.split("&");return n.map(function(t){if(-1===t.indexOf("="))e[t]=!0;else{var n=t.split("="),r=u(n,2),o=r[0],i=r[1];(0===i.indexOf("[")||0===i.indexOf("{"))&&(i=JSON.parse(i)),e[o.trim()]=i}}),e}var o=n(3)["default"],i=n(7)["default"],u=n(8)["default"],a=n(49)["default"],s=n(9)["default"],c=n(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var f=n(54),l=c(f),d=n(64),p=c(d),h=n(67),y=c(h),v=l["default"].getPolyfill(),g=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];i(this,t),this.baseUrl=e,this.loggingEnabled=!1,this.defaultQuery=function(){},this.batchUrl=null,this.collections={},this.singles={},this.requestInterceptors=[],this.responseInterceptors=[]}return o(t,[{key:"init",value:function(t){for(var e in t)Array.isArray(t[e])?this.addCollection(e,new p["default"](t[e],"id")):this.addSingle(e,new y["default"](t[e]))}},{key:"toggleLogging",value:function(){this.loggingEnabled=!this.loggingEnabled}},{key:"setDefaultQuery",value:function(t){this.defaultQuery=t}},{key:"setBatchUrl",value:function(t){this.batchUrl=t}},{key:"setBatch",value:function(t){console.warn("Server.setBatch() is deprecated, use Server.setBatchUrl() instead"),this.batchUrl=t}},{key:"addCollection",value:function(t,e){this.collections[t]=e,e.setServer(this),e.setName(t)}},{key:"getCollection",value:function(t){return this.collections[t]}},{key:"getCollectionNames",value:function(){return a(this.collections)}},{key:"addSingle",value:function(t,e){this.singles[t]=e,e.setServer(this),e.setName(t)}},{key:"getSingle",value:function(t){return this.singles[t]}},{key:"getSingleNames",value:function(){return a(this.singles)}},{key:"addRequestInterceptor",value:function(t){this.requestInterceptors.push(t)}},{key:"addResponseInterceptor",value:function(t){this.responseInterceptors.push(t)}},{key:"getCount",value:function(t,e){return this.collections[t].getCount(e)}},{key:"getAll",value:function(t,e){return this.collections[t].getAll(e)}},{key:"getOne",value:function(t,e,n){return this.collections[t].getOne(e,n)}},{key:"addOne",value:function(t,e){return this.collections[t].addOne(e)}},{key:"updateOne",value:function(t,e,n){return this.collections[t].updateOne(e,n)}},{key:"removeOne",value:function(t,e){return this.collections[t].removeOne(e)}},{key:"getOnly",value:function(t,e){return this.singles[t].getOnly()}},{key:"updateOnly",value:function(t,e){return this.singles[t].updateOnly(e)}},{key:"decode",value:function(t){if(t.queryString=decodeURIComponent(t.url.slice(t.url.indexOf("?")+1)),t.params=r(t.queryString),t.requestBody)try{t.json=JSON.parse(t.requestBody)}catch(e){}return this.requestInterceptors.reduce(function(t,e){return e(t)},t)}},{key:"respond",value:function(t,e,n){var r=arguments.length<=3||void 0===arguments[3]?200:arguments[3];e||(e={}),e["Content-Type"]||(e["Content-Type"]="application/json");var o={status:r,headers:e,body:t};return o=this.responseInterceptors.reduce(function(t,e){return e(t,n)},o),this.log(n,o),n.respond(o.status,o.headers,JSON.stringify(o.body))}},{key:"log",value:function(t,e){this.loggingEnabled&&(console.group?(console.groupCollapsed(t.method,t.url,"(FakeRest)"),console.group("request"),console.log(t.method,t.url),console.log("headers",t.requestHeaders),console.log("body   ",t.requestBody),console.groupEnd(),console.group("response",e.status),console.log("headers",e.headers),console.log("body   ",e.body),console.groupEnd(),console.groupEnd()):(console.log("FakeRest request ",t.method,t.url,"headers",t.requestHeaders,"body",t.requestBody),console.log("FakeRest response",e.status,"headers",e.headers,"body",e.body)))}},{key:"batch",value:function(t){var e=t.json,n=this.handle.bind(this),r=a(e).reduce(function(t,r){var o,i={url:e[r],method:"GET",params:{},respond:function(t,e,n){o={code:t,headers:a(e||{}).map(function(t){return{name:t,value:e[t]}}),body:n||{}}}};return n(i),t[r]=o||{code:404,headers:[],body:{}},t},{});return this.respond(r,{},t,200)}},{key:"handle",value:function(t){if(t=this.decode(t),this.batchUrl&&this.batchUrl===t.url&&"POST"===t.method)return this.batch(t);var e=!0,n=!1,r=void 0;try{for(var o,i=s(this.getSingleNames());!(e=(o=i.next()).done);e=!0){var u=o.value,a=t.url.match(new RegExp("^"+this.baseUrl+"\\/("+u+")(\\/?.*)?$"));if(a){if("GET"==t.method)try{var c=this.getOnly(u);return this.respond(c,null,t)}catch(f){return t.respond(404)}if("PUT"==t.method)try{var c=this.updateOnly(u,t.json);return this.respond(c,null,t)}catch(f){return t.respond(404)}if("PATCH"==t.method)try{var c=this.updateOnly(u,t.json);return this.respond(c,null,t)}catch(f){return t.respond(404)}}}}catch(l){n=!0,r=l}finally{try{!e&&i["return"]&&i["return"]()}finally{if(n)throw r}}var d=!0,p=!1,h=void 0;try{for(var y,g=s(this.getCollectionNames());!(d=(y=g.next()).done);d=!0){var b=y.value,a=t.url.match(new RegExp("^"+this.baseUrl+"\\/("+b+")(\\/(\\d+))?(\\?.*)?$"));if(a){var m=v({},this.defaultQuery(b),t.params);if(a[2]){var O=a[3];if("GET"==t.method)try{var c=this.getOne(b,O,m);return this.respond(c,null,t)}catch(f){return t.respond(404)}if("PUT"==t.method)try{var c=this.updateOne(b,O,t.json);return this.respond(c,null,t)}catch(f){return t.respond(404)}if("PATCH"==t.method)try{var c=this.updateOne(b,O,t.json);return this.respond(c,null,t)}catch(f){return t.respond(404)}if("DELETE"==t.method)try{var c=this.removeOne(b,O);return this.respond(c,null,t)}catch(f){return t.respond(404)}}else{if("GET"==t.method){var w=this.getCount(b,m.filter?{filter:m.filter}:{}),x=void 0,j=void 0,k=void 0;if(w>0){x=this.getAll(b,m);var _=m.range?m.range[0]:0,E=m.range?Math.min(x.length-1+_,m.range[1]):x.length-1;j="items "+_+"-"+E+"/"+w,k=x.length==w?200:206}else x=[],j="items */0",k=200;return this.respond(x,{"Content-Range":j},t,k)}if("POST"==t.method){var S=this.addOne(b,t.json),A=this.baseUrl+"/"+b+"/"+S[this.getCollection(b).identifierName];return this.respond(S,{Location:A},t,201)}}}}}catch(l){p=!0,h=l}finally{try{!d&&g["return"]&&g["return"]()}finally{if(p)throw h}}}},{key:"getHandler",value:function(){return this.handle.bind(this)}}]),t}();e["default"]=g,t.exports=e["default"]},function(t,e,n){"use strict";var r=n(4)["default"];e["default"]=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),r(t,o.key,o)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),e.__esModule=!0},function(t,e,n){t.exports={"default":n(5),__esModule:!0}},function(t,e,n){var r=n(6);t.exports=function(t,e,n){return r.setDesc(t,e,n)}},function(t,e){var n=Object;t.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(t,e){"use strict";e["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e.__esModule=!0},function(t,e,n){"use strict";var r=n(9)["default"],o=n(46)["default"];e["default"]=function(){function t(t,e){var n=[],o=!0,i=!1,u=void 0;try{for(var a,s=r(t);!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(c){i=!0,u=c}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw u}}return n}return function(e,n){if(Array.isArray(e))return e;if(o(Object(e)))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e.__esModule=!0},function(t,e,n){t.exports={"default":n(10),__esModule:!0}},function(t,e,n){n(11),n(38),t.exports=n(41)},function(t,e,n){n(12);var r=n(15);r.NodeList=r.HTMLCollection=r.Array},function(t,e,n){"use strict";var r=n(13),o=n(14),i=n(15),u=n(16);t.exports=n(20)(Array,"Array",function(t,e){this._t=u(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):"keys"==e?o(0,n):"values"==e?o(0,t[n]):o(0,[n,t[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e){t.exports={}},function(t,e,n){var r=n(17),o=n(19);t.exports=function(t){return r(o(t))}},function(t,e,n){var r=n(18);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){"use strict";var r=n(21),o=n(22),i=n(27),u=n(28),a=n(32),s=n(15),c=n(33),f=n(34),l=n(6).getProto,d=n(35)("iterator"),p=!([].keys&&"next"in[].keys()),h="@@iterator",y="keys",v="values",g=function(){return this};t.exports=function(t,e,n,b,m,O,w){c(n,e,b);var x,j,k=function(t){if(!p&&t in A)return A[t];switch(t){case y:return function(){return new n(this,t)};case v:return function(){return new n(this,t)}}return function(){return new n(this,t)}},_=e+" Iterator",E=m==v,S=!1,A=t.prototype,P=A[d]||A[h]||m&&A[m],T=P||k(m);if(P){var I=l(T.call(new t));f(I,_,!0),!r&&a(A,h)&&u(I,d,g),E&&P.name!==v&&(S=!0,T=function(){return P.call(this)})}if(r&&!w||!p&&!S&&A[d]||u(A,d,T),s[e]=T,s[_]=g,m)if(x={values:E?T:k(v),keys:O?T:k(y),entries:E?k("entries"):T},w)for(j in x)j in A||i(A,j,x[j]);else o(o.P+o.F*(p||S),e,x);return x}},function(t,e){t.exports=!0},function(t,e,n){var r=n(23),o=n(24),i=n(25),u="prototype",a=function(t,e,n){var s,c,f,l=t&a.F,d=t&a.G,p=t&a.S,h=t&a.P,y=t&a.B,v=t&a.W,g=d?o:o[e]||(o[e]={}),b=d?r:p?r[e]:(r[e]||{})[u];d&&(n=e);for(s in n)c=!l&&b&&s in b,c&&s in g||(f=c?b[s]:n[s],g[s]=d&&"function"!=typeof b[s]?n[s]:y&&c?i(f,r):v&&b[s]==f?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[u]=t[u],e}(f):h&&"function"==typeof f?i(Function.call,f):f,h&&((g[u]||(g[u]={}))[s]=f))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,t.exports=a},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){var n=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(t,e,n){var r=n(26);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){t.exports=n(28)},function(t,e,n){var r=n(6),o=n(29);t.exports=n(30)?function(t,e,n){return r.setDesc(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){t.exports=!n(31)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){"use strict";var r=n(6),o=n(29),i=n(34),u={};n(28)(u,n(35)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=r.create(u,{next:o(1,n)}),i(t,e+" Iterator")}},function(t,e,n){var r=n(6).setDesc,o=n(32),i=n(35)("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,i)&&r(t,i,{configurable:!0,value:e})}},function(t,e,n){var r=n(36)("wks"),o=n(37),i=n(23).Symbol;t.exports=function(t){return r[t]||(r[t]=i&&i[t]||(i||o)("Symbol."+t))}},function(t,e,n){var r=n(23),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e,n){"use strict";var r=n(39)(!0);n(20)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=r(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){var r=n(40),o=n(19);t.exports=function(t){return function(e,n){var i,u,a=String(o(e)),s=r(n),c=a.length;return 0>s||s>=c?t?"":void 0:(i=a.charCodeAt(s),55296>i||i>56319||s+1===c||(u=a.charCodeAt(s+1))<56320||u>57343?t?a.charAt(s):i:t?a.slice(s,s+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){var r=n(42),o=n(44);t.exports=n(24).getIterator=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}},function(t,e,n){var r=n(43);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var r=n(45),o=n(35)("iterator"),i=n(15);t.exports=n(24).getIteratorMethod=function(t){return void 0!=t?t[o]||t["@@iterator"]||i[r(t)]:void 0}},function(t,e,n){var r=n(18),o=n(35)("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,n,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=(e=Object(t))[o])?n:i?r(e):"Object"==(u=r(e))&&"function"==typeof e.callee?"Arguments":u}},function(t,e,n){t.exports={"default":n(47),__esModule:!0}},function(t,e,n){n(11),n(38),t.exports=n(48)},function(t,e,n){var r=n(45),o=n(35)("iterator"),i=n(15);t.exports=n(24).isIterable=function(t){var e=Object(t);return void 0!==e[o]||"@@iterator"in e||i.hasOwnProperty(r(e))}},function(t,e,n){t.exports={"default":n(50),__esModule:!0}},function(t,e,n){n(51),t.exports=n(24).Object.keys},function(t,e,n){var r=n(52);n(53)("keys",function(t){return function(e){return t(r(e))}})},function(t,e,n){var r=n(19);t.exports=function(t){return Object(r(t))}},function(t,e,n){var r=n(22),o=n(24),i=n(31);t.exports=function(t,e){var n=(o.Object||{})[t]||Object[t],u={};u[t]=e(n),r(r.S+r.F*i(function(){n(1)}),"Object",u)}},function(t,e,n){"use strict";var r=n(55),o=n(59),i=n(62),u=n(63);r(o,{implementation:o,getPolyfill:i,shim:u}),t.exports=o},function(t,e,n){"use strict";var r=n(56),o=n(58),i="function"==typeof Symbol&&"symbol"==typeof Symbol(),u=Object.prototype.toString,a=function(t){return"function"==typeof t&&"[object Function]"===u.call(t)},s=function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(n){return!1}},c=Object.defineProperty&&s(),f=function(t,e,n,r){(!(e in t)||a(r)&&r())&&(c?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},l=function(t,e){var n=arguments.length>2?arguments[2]:{},u=r(e);i&&(u=u.concat(Object.getOwnPropertySymbols(e))),o(u,function(r){f(t,r,e[r],n[r])})};l.supportsDescriptors=!!c,t.exports=l},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=Array.prototype.slice,u=n(57),a=!{toString:null}.propertyIsEnumerable("toString"),s=function(){}.propertyIsEnumerable("prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=function(t){var e=t.constructor;return e&&e.prototype===t},l={$console:!0,$frame:!0,$frameElement:!0,$frames:!0,$parent:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!l["$"+t]&&r.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{f(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),p=function(t){if("undefined"==typeof window||!d)return f(t);try{return f(t)}catch(e){return!1}},h=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===o.call(t),i=u(t),f=e&&"[object String]"===o.call(t),l=[];if(!e&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var d=s&&n;if(f&&t.length>0&&!r.call(t,0))for(var h=0;h<t.length;++h)l.push(String(h));if(i&&t.length>0)for(var y=0;y<t.length;++y)l.push(String(y));else for(var v in t)d&&"prototype"===v||!r.call(t,v)||l.push(String(v));if(a)for(var g=p(t),b=0;b<c.length;++b)g&&"constructor"===c[b]||!r.call(t,c[b])||l.push(c[b]);return l};h.shim=function(){if(Object.keys){var t=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!t){var e=Object.keys;Object.keys=function(t){return e(u(t)?i.call(t):t)}}}else Object.keys=h;return Object.keys||h},t.exports=h},function(t,e){"use strict";var n=Object.prototype.toString;t.exports=function(t){var e=n.call(t),r="[object Arguments]"===e;return r||(r="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===n.call(t.callee)),r}},function(t,e){var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString;t.exports=function(t,e,o){if("[object Function]"!==r.call(e))throw new TypeError("iterator must be a function");var i=t.length;if(i===+i)for(var u=0;i>u;u++)e.call(o,t[u],u,t);else for(var a in t)n.call(t,a)&&e.call(o,t[a],a,t)}},function(t,e,n){"use strict";var r=n(56),o=n(60),i=function(t){return"undefined"!=typeof t&&null!==t},u=n(61)(),a=Object,s=o.call(Function.call,Array.prototype.push),c=o.call(Function.call,Object.prototype.propertyIsEnumerable);t.exports=function(t,e){if(!i(t))throw new TypeError("target must be an object");var n,o,f,l,d,p,h,y=a(t);for(n=1;n<arguments.length;++n){if(o=a(arguments[n]),l=r(o),u&&Object.getOwnPropertySymbols)for(d=Object.getOwnPropertySymbols(o),f=0;f<d.length;++f)h=d[f],c(o,h)&&s(l,h);for(f=0;f<l.length;++f)h=l[f],p=o[h],c(o,h)&&(y[h]=p)}return y}},function(t,e){var n="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,o=Object.prototype.toString,i="[object Function]";t.exports=function(t){var e=this;if("function"!=typeof e||o.call(e)!==i)throw new TypeError(n+e);for(var u=r.call(arguments,1),a=function(){if(this instanceof l){var n=e.apply(this,u.concat(r.call(arguments)));return Object(n)===n?n:this}return e.apply(t,u.concat(r.call(arguments)))},s=Math.max(0,e.length-u.length),c=[],f=0;s>f;f++)c.push("$"+f);var l=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(a);if(e.prototype){var d=function(){};d.prototype=e.prototype,l.prototype=new d,d.prototype=null}return l}},function(t,e,n){"use strict";var r=n(56);t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test");if("string"==typeof e)return!1;var n=42;t[e]=n;for(e in t)return!1;if(0!==r(t).length)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var o=Object.getOwnPropertySymbols(t);if(1!==o.length||o[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(i.value!==n||i.enumerable!==!0)return!1}return!0}},function(t,e,n){"use strict";var r=n(59),o=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),n={},r=0;r<e.length;++r)n[e[r]]=e[r];var o=Object.assign({},n),i="";for(var u in o)i+=u;return t!==i},i=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}};t.exports=function(){return Object.assign?o()?r:i()?r:Object.assign:r}},function(t,e,n){"use strict";var r=n(55),o=n(62);t.exports=function(){var t=o();return r(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}},function(t,e,n){"use strict";function r(t,e){if("function"==typeof e)return t.filter(e);if(e instanceof Object){var n=s(e).map(function(t){if("q"===t){var n=function(){var t=new RegExp(e.q,"i");return{v:function(e){for(var n in e)if(e[n]&&e[n].match&&null!==e[n].match(t))return!0;return!1}}}();if("object"==typeof n)return n.v}var r=e[t];if(-1!==t.indexOf("_lte")){var o=function(){var e=t.replace(/(_lte)$/,"");return{v:function(t){return t[e]<=r}}}();if("object"==typeof o)return o.v}if(-1!==t.indexOf("_gte")){var i=function(){var e=t.replace(/(_gte)$/,"");return{v:function(t){return t[e]>=r}}}();if("object"==typeof i)return i.v}if(-1!==t.indexOf("_lt")){var u=function(){var e=t.replace(/(_lt)$/,"");return{v:function(t){return t[e]<r}}}();if("object"==typeof u)return u.v}if(-1!==t.indexOf("_gt")){var a=function(){var e=t.replace(/(_gt)$/,"");return{v:function(t){return t[e]>r}}}();if("object"==typeof a)return a.v}return Array.isArray(r)?function(e){return r.filter(function(n){return n==e[t]}).length>0}:function(e){return Array.isArray(e[t])&&"string"==typeof r?-1!==e[t].indexOf(r):"boolean"==typeof e[t]&&"string"==typeof r?e[t]==("true"===r?!0:!1):e[t]==r}});return t.filter(function(t){return n.reduce(function(e,n){return e&&n(t)},!0)})}throw new Error("Unsupported filter type")}function o(t,e){if("function"==typeof e)return t.sort(e);if("string"==typeof e)return t.sort(function(t,n){return t[e]>n[e]?1:t[e]<n[e]?-1:0});if(Array.isArray(e)){var n=function(){var n=e[0],r="asc"==e[1].toLowerCase()?1:-1;return{v:t.sort(function(t,e){return t[n]>e[n]?r:t[n]<e[n]?-1*r:0})}}();if("object"==typeof n)return n.v}throw new Error("Unsupported sort type")}function i(t,e){if(Array.isArray(e))return t.slice(e[0],void 0!==e[1]?e[1]+1:void 0);throw new Error("Unsupported range type")}var u=n(3)["default"],a=n(7)["default"],s=n(49)["default"],c=n(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var f=n(54),l=c(f);n(65),n(66);var d=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"id":arguments[1];if(a(this,t),!Array.isArray(e))throw new Error("Can't initialize a Collection with anything else than an array of items");this.sequence=0,this.identifierName=n,this.items=[],this.server=null,this.name=null,e.map(this.addOne.bind(this))}return u(t,[{key:"setServer",value:function(t){this.server=t}},{key:"setName",value:function(t){this.name=t}},{key:"_oneToManyEmbedder",value:function(t){var e=this,n=this.name.slice(0,-1),r=n+"_id";return function(n){var o=e.server.collections[t];if(!o)throw new Error("Can't embed a non-existing collection "+t);return Array.isArray(n[t])?n[t]=o.getAll({filter:function(e){return-1!==n[t].indexOf(e[o.identifierName])}}):n[t]=o.getAll({filter:function(t){return t[r]==n[e.identifierName]}}),n}}},{key:"_manyToOneEmbedder",value:function(t){var e=this,n=t+"s",r=t+"_id";return function(o){var i=e.server.collections[n];if(!i)throw new Error("Can't embed a non-existing collection "+t);try{o[t]=i.getOne(o[r])}catch(u){}return o}}},{key:"_itemEmbedder",value:function(t){var e=this,n=Array.isArray(t)?t:[t],r=n.map(function(t){return t.endsWith("s")?e._oneToManyEmbedder(t):e._manyToOneEmbedder(t)});return function(t){return r.reduce(function(t,e){return e(t)},t)}}},{key:"getCount",value:function(t){return this.getAll(t).length}},{key:"getAll",value:function(t){var e=this.items.slice(0);return t&&(t.filter&&(e=r(e,t.filter)),t.sort&&(e=o(e,t.sort)),t.range&&(e=i(e,t.range)),t.embed&&this.server&&(e=e.map(function(t){return(0,l["default"])({},t)}).map(this._itemEmbedder(t.embed)))),e}},{key:"getIndex",value:function(t){var e=this;return this.items.findIndex(function(n){return n[e.identifierName]==t})}},{key:"getOne",value:function(t,e){var n=this.getIndex(t);if(-1===n)throw new Error("No item with identifier "+t);var r=this.items[n];return e&&e.embed&&this.server&&(r=(0,l["default"])({},r),r=this._itemEmbedder(e.embed)(r)),r}},{key:"addOne",value:function(t){var e=t[this.identifierName];if(void 0!==e){if(-1!==this.getIndex(e))throw new Error("An item with the identifier "+e+" already exists");this.sequence=Math.max(this.sequence,e)+1}else t[this.identifierName]=this.sequence++;return this.items.push(t),t}},{key:"updateOne",value:function(t,e){var n=this.getIndex(t);if(-1===n)throw new Error("No item with identifier "+t);for(var r in e)this.items[n][r]=e[r];return this.items[n]}},{key:"removeOne",value:function(t){var e=this.getIndex(t);if(-1===e)throw new Error("No item with identifier "+t);var n=this.items[e];return this.items.splice(e,1),t==this.sequence-1&&this.sequence--,n}}]),t}();e["default"]=d,t.exports=e["default"]},function(t,e){!function(t){if(!Array.prototype.findIndex){var e=function(t){var e=Object(this),n=Math.max(0,e.length)>>>0;if(0===n)return-1;if("function"!=typeof t||"[object Function]"!==Object.prototype.toString.call(t))throw new TypeError("Array#findIndex: predicate must be a function");for(var r=arguments.length>1?arguments[1]:void 0,o=0;n>o;o++)if(t.call(r,e[o],o,e))return o;return-1};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"findIndex",{value:e,configurable:!0,writable:!0})}catch(n){}Array.prototype.findIndex||(Array.prototype.findIndex=e)}}(this)},function(t,e){/*! http://mths.be/endswith v0.2.0 by @mathias */
String.prototype.endsWith||!function(){"use strict";var t=function(){try{var t={},e=Object.defineProperty,n=e(t,t,t)&&e}catch(r){}return n}(),e={}.toString,n=function(t){if(null==this)throw TypeError();var n=String(this);if(t&&"[object RegExp]"==e.call(t))throw TypeError();var r=n.length,o=String(t),i=o.length,u=r;if(arguments.length>1){var a=arguments[1];void 0!==a&&(u=a?Number(a):0,u!=u&&(u=0))}var s=Math.min(Math.max(u,0),r),c=s-i;if(0>c)return!1;for(var f=-1;++f<i;)if(n.charCodeAt(c+f)!=o.charCodeAt(f))return!1;return!0};t?t(String.prototype,"endsWith",{value:n,configurable:!0,writable:!0}):String.prototype.endsWith=n}()},function(t,e,n){"use strict";var r=n(3)["default"],o=n(7)["default"],i=n(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var u=n(54),a=i(u);n(66);var s=function(){function t(e){if(o(this,t),!(e instanceof Object))throw new Error("Can't initialize a Single with anything except an object");this.obj=e,this.server=null,this.name=null}return r(t,[{key:"setServer",value:function(t){this.server=t}},{key:"setName",value:function(t){this.name=t}},{key:"_oneToManyEmbedder",value:function(t){var e=this;return function(n){var r=e.server.collections[t];if(!r)throw new Error("Can't embed a non-existing collection "+t);return n[t]=r.getAll({filter:function(e){return-1!==n[t].indexOf(e[r.identifierName])}}),n}}},{key:"_manyToOneEmbedder",value:function(t){var e=this,n=t+"s",r=t+"_id";return function(o){var i=e.server.collections[n];if(!i)throw new Error("Can't embed a non-existing collection "+t);try{o[t]=i.getOne(o[r])}catch(u){}return o}}},{key:"_itemEmbedder",value:function(t){var e=this,n=Array.isArray(t)?t:[t],r=n.map(function(t){return t.endsWith("s")?e._oneToManyEmbedder(t):e._manyToOneEmbedder(t)});return function(t){return r.reduce(function(t,e){return e(t)},t)}}},{key:"getOnly",value:function(t){var e=this.obj;return t&&t.embed&&this.server&&(e=(0,a["default"])({},e),e=this._itemEmbedder(t.embed)(e)),e}},{key:"updateOnly",value:function(t){for(var e in t)this.obj[e]=t[e];return this.obj}}]),t}();e["default"]=s,t.exports=e["default"]}])});